{
	"info": {
		"_postman_id": "12345678-1234-1234-1234-123456789012",
		"name": "Social Media Microservices API",
		"description": "Complete API collection for testing the Social Media microservices architecture including Identity Service and API Gateway",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Identity Service",
			"item": [
				{
					"name": "User Registration",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has required fields\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    pm.expect(jsonData).to.have.property('message');",
									"    pm.expect(jsonData).to.have.property('accessToken');",
									"    pm.expect(jsonData).to.have.property('refreshToken');",
									"});",
									"",
									"pm.test(\"Success is true\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"});",
									"",
									"// Store tokens for subsequent requests",
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set(\"accessToken\", jsonData.accessToken);",
									"    pm.environment.set(\"refreshToken\", jsonData.refreshToken);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"testuser{{$randomInt}}\",\n    \"email\": \"testuser{{$randomInt}}@example.com\",\n    \"password\": \"SecurePassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseURL}}/v1/auth/register",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"v1",
								"auth",
								"register"
							]
						},
						"description": "Register a new user account. This endpoint creates a new user and returns access and refresh tokens."
					},
					"response": []
				},
				{
					"name": "User Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has required fields\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('accessToken');",
									"    pm.expect(jsonData).to.have.property('refreshToken');",
									"    pm.expect(jsonData).to.have.property('userId');",
									"});",
									"",
									"// Store tokens for subsequent requests",
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set(\"accessToken\", jsonData.accessToken);",
									"    pm.environment.set(\"refreshToken\", jsonData.refreshToken);",
									"    pm.environment.set(\"userId\", jsonData.userId);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{userEmail}}\",\n    \"password\": \"{{userPassword}}\"\n}"
						},
						"url": {
							"raw": "{{baseURL}}/v1/auth/login",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"v1",
								"auth",
								"login"
							]
						},
						"description": "Login with existing user credentials. Returns access and refresh tokens along with user ID."
					},
					"response": []
				},
				{
					"name": "Refresh Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has new tokens\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('accessToken');",
									"    pm.expect(jsonData).to.have.property('refreshToken');",
									"});",
									"",
									"// Update stored tokens",
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set(\"accessToken\", jsonData.accessToken);",
									"    pm.environment.set(\"refreshToken\", jsonData.refreshToken);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"refreshToken\": \"{{refreshToken}}\"\n}"
						},
						"url": {
							"raw": "{{baseURL}}/v1/auth/refresh-token",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"v1",
								"auth",
								"refresh-token"
							]
						},
						"description": "Refresh the access token using a valid refresh token. Returns new access and refresh tokens."
					},
					"response": []
				},
				{
					"name": "User Logout",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Logout successful\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"    pm.expect(jsonData.message).to.include(\"successfully\");",
									"});",
									"",
									"// Clear stored tokens",
									"pm.environment.unset(\"accessToken\");",
									"pm.environment.unset(\"refreshToken\");",
									"pm.environment.unset(\"userId\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"refreshToken\": \"{{refreshToken}}\"\n}"
						},
						"url": {
							"raw": "{{baseURL}}/v1/auth/logout",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"v1",
								"auth",
								"logout"
							]
						},
						"description": "Logout user by invalidating the refresh token."
					},
					"response": []
				}
			],
			"description": "Authentication endpoints routed through the API Gateway to the Identity Service"
		},
		{
			"name": "Error Scenarios",
			"item": [
				{
					"name": "Register - Duplicate User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error message for duplicate user\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(false);",
									"    pm.expect(jsonData.message).to.include(\"already exists\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"testuser1\",\n    \"email\": \"testuser1@example.com\",\n    \"password\": \"SecurePassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseURL}}/v1/auth/register",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"v1",
								"auth",
								"register"
							]
						},
						"description": "Test duplicate user registration - should return 400 error"
					},
					"response": []
				},
				{
					"name": "Login - Invalid Credentials",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error message for invalid credentials\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(false);",
									"    pm.expect(jsonData.message).to.include(\"Invalid\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"nonexistent@example.com\",\n    \"password\": \"WrongPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseURL}}/v1/auth/login",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"v1",
								"auth",
								"login"
							]
						},
						"description": "Test login with invalid credentials - should return 400 error"
					},
					"response": []
				},
				{
					"name": "Rate Limit Test",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// This test may pass initially but will fail after 100 requests in 15 minutes",
									"if (pm.response.code === 429) {",
									"    pm.test(\"Rate limit working - Status code is 429\", function () {",
									"        pm.response.to.have.status(429);",
									"    });",
									"    ",
									"    pm.test(\"Rate limit error message\", function () {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData.message).to.include(\"Too many requests\");",
									"    });",
									"} else {",
									"    pm.test(\"Request within rate limit\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{userEmail}}\",\n    \"password\": \"{{userPassword}}\"\n}"
						},
						"url": {
							"raw": "{{baseURL}}/v1/auth/login",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"v1",
								"auth",
								"login"
							]
						},
						"description": "Test rate limiting - run multiple times quickly to trigger rate limit"
					},
					"response": []
				}
			],
			"description": "Test various error scenarios and edge cases"
		},
		{
			"name": "Health Checks",
			"item": [
				{
					"name": "API Gateway Health",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"API Gateway is responding\", function () {",
									"    // If we get any response, the gateway is up",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404, 500]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseURL}}/health",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"health"
							]
						},
						"description": "Basic health check for API Gateway"
					},
					"response": []
				}
			],
			"description": "Health check endpoints"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global pre-request script",
					"console.log('Making request to:', pm.request.url.toString());"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test script",
					"pm.test(\"Response time is less than 5000ms\", function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(5000);",
					"});",
					"",
					"pm.test(\"Response has proper JSON structure\", function () {",
					"    pm.response.to.be.json;",
					"});"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseURL",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "userEmail",
			"value": "testuser1@example.com",
			"type": "string"
		},
		{
			"key": "userPassword",
			"value": "SecurePassword123!",
			"type": "string"
		}
	]
}